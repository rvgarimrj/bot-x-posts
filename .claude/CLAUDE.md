<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>

# Bot-X-Posts - Regras e Configuracoes

## Visao Geral

Bot automatizado para postar no X (Twitter) via Puppeteer conectado ao Chrome em modo debug. Gera posts bilingues (EN + PT-BR) sobre crypto, investing, AI e vibeCoding usando curadoria multi-fonte + Claude.

## Arquitetura V2 (Multi-Source Bilingual)

```
Cron (8h,10h,12h,14h,16h,18h,20h - Daily)
    │
    ▼
┌─────────────────────────────────────────────────┐
│              CURATE-V3 (Orquestrador)           │
│                                                 │
│  Para cada topico, busca em paralelo:          │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ Fonte 1 │ │ Fonte 2 │ │ Fonte 3 │           │
│  └────┬────┘ └────┬────┘ └────┬────┘           │
│       └───────────┼───────────┘                 │
│                   ▼                             │
│            Cache Manager                        │
│       (fresh 30min, stale 4h)                  │
└─────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────┐
│           CLAUDE-V2 (Analise + Geracao)         │
│                                                 │
│  • Analisa sentiment/narrativa                  │
│  • Gera 2 posts por topico (EN + PT-BR)        │
│  • System prompts diferentes por idioma        │
└─────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────┐
│            TELEGRAM PREVIEW (2 min)             │
│         8 posts com botao de cancelar          │
└─────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────┐
│         PUPPETEER POST (60s entre posts)        │
│      Digitacao humanizada, Chrome debug        │
└─────────────────────────────────────────────────┘
```

## Horarios e Topicos (TODOS OS DIAS)

| Horario | Posts | Topicos | Idiomas |
|---------|-------|---------|---------|
| 8h | 8 | crypto, investing, ai, vibeCoding | EN + PT-BR |
| 10h | 8 | crypto, investing, ai, vibeCoding | EN + PT-BR |
| 12h | 8 | crypto, investing, ai, vibeCoding | EN + PT-BR |
| 14h | 8 | crypto, investing, ai, vibeCoding | EN + PT-BR |
| 16h | 8 | crypto, investing, ai, vibeCoding | EN + PT-BR |
| 18h | 8 | crypto, investing, ai, vibeCoding | EN + PT-BR |
| 20h | 8 | crypto, investing, ai, vibeCoding | EN + PT-BR |

**Total:** 56 posts/dia x 7 dias = 392 posts/semana

## Arquivos Principais

### V2 (Novo - Multi-Source Bilingual)
| Arquivo | Funcao |
|---------|--------|
| `scripts/cron-daemon-v2.js` | Daemon V2: 7 horarios, todos os dias |
| `scripts/auto-post-v2.js` | Fluxo V2: 8 posts (4 topicos x 2 idiomas) |
| `src/curate-v3.js` | Curadoria multi-fonte com fallback chains |
| `src/claude-v2.js` | Geracao bilingue (EN + PT-BR) |
| `src/sources/` | Modulos de fontes de dados |

### V1 (Legacy)
| Arquivo | Funcao |
|---------|--------|
| `scripts/cron-daemon.js` | Daemon V1: 4 horarios, Seg-Sab |
| `scripts/auto-post.js` | Fluxo V1: 3 posts por horario |
| `src/curate-v2.js` | Curadoria com Twitter API |
| `src/claude.js` | Geracao PT-BR apenas |

### Comum
| Arquivo | Funcao |
|---------|--------|
| `src/puppeteer-post.js` | Posta no X via Chrome debug |
| `src/telegram-v2.js` | Notificacoes Telegram |

## Fontes de Dados por Topico (V2)

### CRYPTO
| Prioridade | Fonte | Rate Limit | Dados |
|------------|-------|------------|-------|
| Primary | CoinGecko | 30/min | BTC/ETH precos, Fear&Greed, trending |
| Primary | Reddit r/cryptocurrency | 60/min | Hot posts, sentiment |
| Fallback | RSS (CoinTelegraph, CryptoNews) | Ilimitado | Noticias |

### INVESTING
| Prioridade | Fonte | Rate Limit | Dados |
|------------|-------|------------|-------|
| Primary | Finnhub | 60/min | Noticias, earnings |
| Primary | Reddit r/stocks, r/wallstreetbets | 60/min | Hot posts, tickers |
| Fallback | RSS (MarketWatch) | Ilimitado | Noticias |

### AI
| Prioridade | Fonte | Rate Limit | Dados |
|------------|-------|------------|-------|
| Primary | HuggingFace Hub | Ilimitado | Modelos trending |
| Primary | Reddit r/MachineLearning, r/ChatGPT | 60/min | Discussoes |
| Secondary | arXiv API | 3/sec | Papers recentes |
| Fallback | RSS (TechCrunch AI) | Ilimitado | Noticias |

### VIBECODING
| Prioridade | Fonte | Rate Limit | Dados |
|------------|-------|------------|-------|
| Primary | HackerNews | Ilimitado | Top stories |
| Primary | GitHub API | 60/hora | Repos trending |
| Secondary | Reddit r/Cursor, r/LocalLLaMA | 60/min | Discussoes |
| Fallback | RSS (Dev.to) | Ilimitado | Artigos |

## Configuracoes Criticas

### Chrome Debug Mode
Chrome DEVE rodar com:
```bash
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome \
  --remote-debugging-port=9222 \
  --disable-background-timer-throttling \
  --disable-backgrounding-occluded-windows \
  --disable-renderer-backgrounding
```

### LaunchAgent (Daemon)
Arquivo: `~/Library/LaunchAgents/com.botxposts.daemon.plist`
- Chama `/usr/local/bin/node scripts/cron-daemon.js` diretamente
- WorkingDirectory: `/Users/user/AppsCalude/Bot-X-Posts`
- KeepAlive com SuccessfulExit: false (reinicia apenas em crash)
- ThrottleInterval: 30 segundos

### Caminhos Absolutos
**IMPORTANTE:** Quando spawn processos via launchd, SEMPRE usar caminho absoluto:
- Node: `/usr/local/bin/node` (NAO apenas `node`)

### Anti-Timeout (Mac Sleep)
- App Nap desativado para Chrome: `defaults write com.google.Chrome NSAppSleepDisabled -bool YES`
- ProcessType: Interactive no plist
- Timeouts configurados: 60s page, 120s protocol

## Curadoria v2

### Fontes de Dados
- **CoinGecko:** Preco BTC/ETH, Fear & Greed Index, trending coins
- **Twitter API:** Busca trending com extracao de autores, hashtags e mentions
- **Hacker News:** Top stories para vibeCoding
- **Claude:** Analise de sentimento, narrativas e angulos sugeridos

### Dados Extraidos do X (TODOS os topicos)

Para **crypto**, **investing** e **vibeCoding**, o sistema extrai:

| Dado | Descricao | Uso |
|------|-----------|-----|
| `topTweets` | Tweets ordenados por velocidade viral | Contexto para Claude |
| `trendingHashtags` | Hashtags mais usadas nos tweets | Incluir no post |
| `topAuthors` | @usuarios + followers dos tweets virais | Referenciar no post |
| `topMentions` | @contas mais mencionadas | Referenciar no post |
| `influencers` | Lista pre-definida por nicho | Sugestao de mencao |

### Queries de Busca por Topico

```javascript
crypto: 'Bitcoin OR #BTC OR #crypto -filter:retweets'
investing: 'stocks OR #SP500 OR $NVDA OR $TSLA -filter:retweets'
vibeCoding: 'Claude Code OR Cursor AI OR "vibe coding" OR "AI coding" -filter:retweets'
```

### Influencers Pre-definidos

```javascript
crypto: ['@sabortoothpete', '@CryptoCapo_', '@WClementeIII', '@documentingbtc', '@BitcoinMagazine']
investing: ['@jimcramer', '@StockMKTNewz', '@unusual_whales', '@DeItaone', '@zaborowski']
vibeCoding: ['@kaborowski', '@alexalbert__', '@cursor_ai', '@AnthropicAI', '@OpenAI']
```

### Prompt para Geracao de Posts

O `formatForPrompt()` envia para Claude:
```
DADOS EM TEMPO REAL:
- BTC: $83000 (-0.5%)
- Fear & Greed: 20 (Extreme Fear)

SENTIMENTO DO X: mixed (score: -15)
NARRATIVA DOMINANTE: Bitcoin consolidando enquanto mercado em medo

HASHTAGS EM ALTA: #Bitcoin #crypto #BTC
CONTAS ATIVAS: @StckStratgy (8247), @cryptogallant (1750)
MAIS MENCIONADOS: @Bitcoin, @elenakvcs
INFLUENCERS DO NICHO: @CryptoCapo_, @BitcoinMagazine

TWEETS VIRAIS NO MOMENTO:
1. [45.2/h por @usuario] "texto do tweet..."

INSTRUÇÕES EXTRAS:
- Use 1-2 hashtags relevantes do trending
- Se fizer sentido, mencione ou referencie uma conta ativa
- Mantenha o tom autêntico e não pareça bot
```

### Rate Limits e Cache

| Config | Valor | Motivo |
|--------|-------|--------|
| Cache fresco | 60 min | Evita requests repetidos |
| Cache stale | 4 horas | Fallback quando rate limited |
| Delay entre buscas | 5 segundos | Evita rate limit |
| Queries por topico | 1 (com OR) | Menos requests |
| Deteccao rate limit | Automatica | Para de tentar por 15min |

### IMPORTANTE: O que os Cron Jobs DEVEM fazer

1. **Curadoria v2** busca dados frescos + trending do X
2. **Extrair** hashtags, autores e mentions dos tweets virais
3. **Passar** esses dados para o Claude via `formatForPrompt()`
4. **Claude gera** posts usando hashtags trending e referencias a contas
5. **Posts incluem** 1-2 hashtags relevantes e podem mencionar contas ativas

## Comandos Uteis

```bash
# ===== V2 (Recomendado) =====

# Iniciar daemon V2
npm run start:v2

# Testar uma source individual
node scripts/test-source.js coingecko
node scripts/test-source.js reddit investing
node scripts/test-source.js finnhub
node scripts/test-source.js hackernews
node scripts/test-source.js github
node scripts/test-source.js huggingface

# Testar curadoria V3
node scripts/test-curate-v3.js              # Todos os topicos
node scripts/test-curate-v3.js crypto       # Topico especifico

# Testar geracao bilingue
node scripts/test-generate-v2.js            # Todos
node scripts/test-generate-v2.js crypto en  # Especifico

# Rodar ciclo completo (dry-run)
node scripts/auto-post-v2.js

# ===== V1 (Legacy) =====

# Status do daemon V1
launchctl list | grep bot

# Ver logs
tail -f logs/daemon.log
tail -f logs/daemon-error.log

# Reiniciar daemon V1
pkill -9 -f "cron-daemon"
launchctl unload ~/Library/LaunchAgents/com.botxposts.daemon.plist
launchctl load ~/Library/LaunchAgents/com.botxposts.daemon.plist

# Testar post manual V1
node scripts/auto-post.js vibeCoding

# ===== Comum =====

# Verificar Chrome conectado
curl -s http://localhost:9222/json/version
```

## Problemas Conhecidos e Solucoes

| Problema | Causa | Solucao |
|----------|-------|---------|
| `spawn node ENOENT` | PATH nao disponivel no launchd | Usar `/usr/local/bin/node` |
| Daemons duplicados | plist reiniciando rapido | ThrottleInterval + KeepAlive config |
| Telegram 409 Conflict | Multiplas instancias polling | Garantir apenas 1 daemon |
| Aba X nao encontrada | Chrome sem X.com aberto | Codigo abre automaticamente |
| Timeout com tela bloqueada | App Nap / throttling | Flags anti-suspensao no Chrome |
| Twitter rate limit | Muitas requisicoes | Cache de 15 min, fallback |
| Post truncado (so ultimo paragrafo) | execCommand em chunks sobrescreve | Usar clipboard (Cmd+V) |
| Daemon crash silencioso | `.catch()` em funcao sync | Usar try/catch para unlinkSync |

## Fluxo de Postagem (V2)

1. Cron dispara a cada 2h (8h-20h, todos os dias)
2. `curateContentV3()` busca de multiplas fontes em paralelo
3. Fallback chain: Primary -> Secondary -> RSS
4. `generatePost()` gera 8 posts (4 topicos x 2 idiomas)
5. Preview enviado no Telegram (2 min para cancelar)
6. `postTweet()` digita no X como humano (delays variaveis)
7. 60s entre cada post (total ~12 min por slot)
8. Confirmacao no Telegram

## Diferenciacao EN vs PT-BR

### Posts em Ingles
- System prompt: Global developer perspective
- Hashtags: #AI #VibeCoding #ClaudeCode #Cursor
- Tom: Tecnico, direto, internacional

### Posts em Portugues
- System prompt: @garim (prompt original)
- Hashtags: #DevBR #ClaudeCode #Cursor #VibeCoding
- Tom: Pratico, conversacional, brasileiro

**IMPORTANTE:** Ambos na mesma conta @garim, intercalados. NAO sao traducoes - Claude gera independentemente.

## Notas de Desenvolvimento

- Posts max 500 chars
- Digitacao humanizada: 70-130ms entre chars, pausas apos pontuacao
- 60 segundos entre posts multiplos
- Retry automatico: 3 tentativas na conexao Chrome, 2 no post
- Cache: 30 min fresco, 4h stale para fallback

## Premissas e Licoes Aprendidas

### Insercao de Texto no X (IMPORTANTE)
| Metodo | Funciona? | Problema |
|--------|-----------|----------|
| `execCommand('insertText')` em chunks | NAO | Cada chunk sobrescreve o anterior |
| `keyboard.type()` char por char | SIM (lento) | ~100ms por char, OK para fallback |
| **Clipboard (Cmd+V)** | **SIM** | **Metodo principal - mais confiavel** |

**SEMPRE usar clipboard para textos longos.** A insercao via DOM em chunks perde texto.

### Funcoes Sync vs Async (Node.js)
| Funcao | Tipo | Tem .catch()? |
|--------|------|---------------|
| `fs.unlinkSync()` | Sync | NAO - usar try/catch |
| `fs.unlink()` | Async (callback) | NAO - usar promisify |
| `fs.promises.unlink()` | Async (Promise) | SIM |

**NUNCA usar `.catch()` em funcoes sync.** Causa crash silencioso.

### Daemon e Hot Reload
- Daemon usa `spawn()` para executar scripts
- Codigo e carregado do disco A CADA execucao
- **NAO precisa reiniciar daemon** apos editar `auto-post.js` ou `puppeteer-post.js`
- So reiniciar se editar `cron-daemon.js` (o proprio daemon)

### Verificacao de Posts
Sempre logar no puppeteer-post.js:
1. Quantos chars foram inseridos vs esperado
2. Primeiros 100 chars do texto final (para debug)
3. Se texto < 80% do esperado, avisar antes de postar

## Historico de Commits
- **2026-02-02 19:07** [`3f7b9c5`] Fix text truncation: use clipboard instead of chunked DOM insert (src/puppeteer-post.js)
- **2026-02-02 16:33** [`bc9f5ba`] Fix daemon crash: unlinkSync is sync, not async (scripts/cron-daemon.js)
- **2026-02-02 09:55** [`9f07b6a`] Add multi-source bilingual posting system (v2) (.gitignore,scripts/auto-post-v2.js,scripts/cron-daemon-v2.js,scripts/test-curate-v3.js,scripts/test-generate-v2.js)
- **2026-01-31 14:24** [`68b36b1`] Update CLAUDE.md commit history (.claude/CLAUDE.md)
- **2026-01-31 13:19** [`595d0e1`] Add singleton check to prevent duplicate daemon instances (scripts/cron-daemon.js)
- **2026-01-31 11:07** [`c2e5217`] Change schedule from Mon-Fri to Mon-Sat (1-6) (.claude/CLAUDE.md,scripts/cron-daemon.js)
- **2026-01-31 09:11** [`df9c934`] Document curadoria v2 with hashtags, authors, mentions in CLAUDE.md (.claude/CLAUDE.md)
- **2026-01-31 09:07** [`99e6329`] Improve curate-v2: add authors, hashtags, mentions + optimize rate limits (scripts/test-curate-v2.js,src/curate-v2.js)
- **2026-01-30 21:34** [`4afae02`] Update CLAUDE.md with commit history from hook (.claude/CLAUDE.md)
- **2026-01-30 21:32** [`a5e3a5a`] Add post-commit hook to track changes in CLAUDE.md (.claude/CLAUDE.md,.claude/hooks/post-commit-summary.sh)

- **2026-01-30 19:56** [`f820a89`] Add curate-v2 with real-time data and fix daemon issues (src/curate-v2.js, scripts/auto-post.js, src/puppeteer-post.js, scripts/cron-daemon.js, .claude/CLAUDE.md)
- **2026-01-30 15:32** [`b8ce216`] Add anti-suspension measures for Chrome timeout issues
- **2026-01-30 14:23** [`2325973`] Fix first post failure by navigating to /home before posting