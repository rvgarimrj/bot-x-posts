<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>

# Bot-X-Posts - Regras e Configuracoes

## Visao Geral

Bot automatizado para postar no X (Twitter) via Puppeteer conectado ao Chrome em modo debug. Gera posts sobre crypto, investing e vibeCoding usando curadoria de dados + Claude.

## Arquitetura

```
Cron (8h, 12h, 14h, 18h) -> Curadoria v2 -> Claude (gera posts) -> Telegram Preview -> Puppeteer Post
```

## Horarios e Topicos (Seg-Sab)

| Horario | Posts | Topicos |
|---------|-------|---------|
| 8h | 3 | crypto, investing, vibeCoding |
| 12h | 3 | crypto, investing, vibeCoding |
| 14h | 1 | vibeCoding |
| 18h | 1 | vibeCoding |

**Total:** 8 posts/dia x 6 dias = 48 posts/semana (4 vibeCoding, 2 crypto, 2 investing por dia)

## Arquivos Principais

| Arquivo | Funcao |
|---------|--------|
| `scripts/cron-daemon.js` | Daemon principal com agendamento |
| `scripts/auto-post.js` | Fluxo completo: curadoria -> gerar -> preview -> postar |
| `src/curate-v2.js` | Curadoria com dados frescos (CoinGecko, Twitter, HN) |
| `src/puppeteer-post.js` | Posta no X via Chrome debug |
| `src/claude.js` | Gera posts com Claude |
| `src/telegram-v2.js` | Notificacoes Telegram |

## Configuracoes Criticas

### Chrome Debug Mode
Chrome DEVE rodar com:
```bash
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome \
  --remote-debugging-port=9222 \
  --disable-background-timer-throttling \
  --disable-backgrounding-occluded-windows \
  --disable-renderer-backgrounding
```

### LaunchAgent (Daemon)
Arquivo: `~/Library/LaunchAgents/com.botxposts.daemon.plist`
- Chama `/usr/local/bin/node scripts/cron-daemon.js` diretamente
- WorkingDirectory: `/Users/user/AppsCalude/Bot-X-Posts`
- KeepAlive com SuccessfulExit: false (reinicia apenas em crash)
- ThrottleInterval: 30 segundos

### Caminhos Absolutos
**IMPORTANTE:** Quando spawn processos via launchd, SEMPRE usar caminho absoluto:
- Node: `/usr/local/bin/node` (NAO apenas `node`)

### Anti-Timeout (Mac Sleep)
- App Nap desativado para Chrome: `defaults write com.google.Chrome NSAppSleepDisabled -bool YES`
- ProcessType: Interactive no plist
- Timeouts configurados: 60s page, 120s protocol

## Curadoria v2

### Fontes de Dados
- **CoinGecko:** Preco BTC/ETH, Fear & Greed Index, trending coins
- **Twitter API:** Busca trending com extracao de autores, hashtags e mentions
- **Hacker News:** Top stories para vibeCoding
- **Claude:** Analise de sentimento, narrativas e angulos sugeridos

### Dados Extraidos do X (TODOS os topicos)

Para **crypto**, **investing** e **vibeCoding**, o sistema extrai:

| Dado | Descricao | Uso |
|------|-----------|-----|
| `topTweets` | Tweets ordenados por velocidade viral | Contexto para Claude |
| `trendingHashtags` | Hashtags mais usadas nos tweets | Incluir no post |
| `topAuthors` | @usuarios + followers dos tweets virais | Referenciar no post |
| `topMentions` | @contas mais mencionadas | Referenciar no post |
| `influencers` | Lista pre-definida por nicho | Sugestao de mencao |

### Queries de Busca por Topico

```javascript
crypto: 'Bitcoin OR #BTC OR #crypto -filter:retweets'
investing: 'stocks OR #SP500 OR $NVDA OR $TSLA -filter:retweets'
vibeCoding: 'Claude Code OR Cursor AI OR "vibe coding" OR "AI coding" -filter:retweets'
```

### Influencers Pre-definidos

```javascript
crypto: ['@sabortoothpete', '@CryptoCapo_', '@WClementeIII', '@documentingbtc', '@BitcoinMagazine']
investing: ['@jimcramer', '@StockMKTNewz', '@unusual_whales', '@DeItaone', '@zaborowski']
vibeCoding: ['@kaborowski', '@alexalbert__', '@cursor_ai', '@AnthropicAI', '@OpenAI']
```

### Prompt para Geracao de Posts

O `formatForPrompt()` envia para Claude:
```
DADOS EM TEMPO REAL:
- BTC: $83000 (-0.5%)
- Fear & Greed: 20 (Extreme Fear)

SENTIMENTO DO X: mixed (score: -15)
NARRATIVA DOMINANTE: Bitcoin consolidando enquanto mercado em medo

HASHTAGS EM ALTA: #Bitcoin #crypto #BTC
CONTAS ATIVAS: @StckStratgy (8247), @cryptogallant (1750)
MAIS MENCIONADOS: @Bitcoin, @elenakvcs
INFLUENCERS DO NICHO: @CryptoCapo_, @BitcoinMagazine

TWEETS VIRAIS NO MOMENTO:
1. [45.2/h por @usuario] "texto do tweet..."

INSTRUÇÕES EXTRAS:
- Use 1-2 hashtags relevantes do trending
- Se fizer sentido, mencione ou referencie uma conta ativa
- Mantenha o tom autêntico e não pareça bot
```

### Rate Limits e Cache

| Config | Valor | Motivo |
|--------|-------|--------|
| Cache fresco | 60 min | Evita requests repetidos |
| Cache stale | 4 horas | Fallback quando rate limited |
| Delay entre buscas | 5 segundos | Evita rate limit |
| Queries por topico | 1 (com OR) | Menos requests |
| Deteccao rate limit | Automatica | Para de tentar por 15min |

### IMPORTANTE: O que os Cron Jobs DEVEM fazer

1. **Curadoria v2** busca dados frescos + trending do X
2. **Extrair** hashtags, autores e mentions dos tweets virais
3. **Passar** esses dados para o Claude via `formatForPrompt()`
4. **Claude gera** posts usando hashtags trending e referencias a contas
5. **Posts incluem** 1-2 hashtags relevantes e podem mencionar contas ativas

## Comandos Uteis

```bash
# Status do daemon
launchctl list | grep bot

# Ver logs
tail -f logs/daemon.log
tail -f logs/daemon-error.log

# Reiniciar daemon
pkill -9 -f "cron-daemon"
launchctl unload ~/Library/LaunchAgents/com.botxposts.daemon.plist
launchctl load ~/Library/LaunchAgents/com.botxposts.daemon.plist

# Testar post manual
node scripts/auto-post.js vibeCoding

# Verificar Chrome conectado
curl -s http://localhost:9222/json/version
```

## Problemas Conhecidos e Solucoes

| Problema | Causa | Solucao |
|----------|-------|---------|
| `spawn node ENOENT` | PATH nao disponivel no launchd | Usar `/usr/local/bin/node` |
| Daemons duplicados | plist reiniciando rapido | ThrottleInterval + KeepAlive config |
| Telegram 409 Conflict | Multiplas instancias polling | Garantir apenas 1 daemon |
| Aba X nao encontrada | Chrome sem X.com aberto | Codigo abre automaticamente |
| Timeout com tela bloqueada | App Nap / throttling | Flags anti-suspensao no Chrome |
| Twitter rate limit | Muitas requisicoes | Cache de 15 min, fallback |

## Fluxo de Postagem

1. Cron dispara no horario
2. `curateContentV2()` busca dados frescos
3. `generatePost()` gera texto com Claude
4. Preview enviado no Telegram (2 min para cancelar)
5. `postTweet()` digita no X como humano (delays variaveis)
6. Confirmacao no Telegram

## Notas de Desenvolvimento

- Posts max 500 chars
- Digitacao humanizada: 70-130ms entre chars, pausas apos pontuacao
- 60 segundos entre posts multiplos
- Retry automatico: 3 tentativas na conexao Chrome, 2 no post

## Historico de Commits
- **2026-01-31 09:11** [`df9c934`] Document curadoria v2 with hashtags, authors, mentions in CLAUDE.md (.claude/CLAUDE.md)
- **2026-01-31 09:07** [`99e6329`] Improve curate-v2: add authors, hashtags, mentions + optimize rate limits (scripts/test-curate-v2.js,src/curate-v2.js)
- **2026-01-30 21:34** [`4afae02`] Update CLAUDE.md with commit history from hook (.claude/CLAUDE.md)
- **2026-01-30 21:32** [`a5e3a5a`] Add post-commit hook to track changes in CLAUDE.md (.claude/CLAUDE.md,.claude/hooks/post-commit-summary.sh)

- **2026-01-30 19:56** [`f820a89`] Add curate-v2 with real-time data and fix daemon issues (src/curate-v2.js, scripts/auto-post.js, src/puppeteer-post.js, scripts/cron-daemon.js, .claude/CLAUDE.md)
- **2026-01-30 15:32** [`b8ce216`] Add anti-suspension measures for Chrome timeout issues
- **2026-01-30 14:23** [`2325973`] Fix first post failure by navigating to /home before posting