<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>

# Bot-X-Posts - Regras e Configuracoes

## Visao Geral

Bot automatizado para postar no X (Twitter) via Puppeteer conectado ao Chrome em modo debug. Gera posts sobre crypto, investing e vibeCoding usando curadoria de dados + Claude.

## Arquitetura

```
Cron (8h, 12h, 14h, 18h) -> Curadoria v2 -> Claude (gera posts) -> Telegram Preview -> Puppeteer Post
```

## Horarios e Topicos (Seg-Sex)

| Horario | Posts | Topicos |
|---------|-------|---------|
| 8h | 3 | crypto, investing, vibeCoding |
| 12h | 3 | crypto, investing, vibeCoding |
| 14h | 1 | vibeCoding |
| 18h | 1 | vibeCoding |

**Total:** 8 posts/dia (4 vibeCoding, 2 crypto, 2 investing)

## Arquivos Principais

| Arquivo | Funcao |
|---------|--------|
| `scripts/cron-daemon.js` | Daemon principal com agendamento |
| `scripts/auto-post.js` | Fluxo completo: curadoria -> gerar -> preview -> postar |
| `src/curate-v2.js` | Curadoria com dados frescos (CoinGecko, Twitter, HN) |
| `src/puppeteer-post.js` | Posta no X via Chrome debug |
| `src/claude.js` | Gera posts com Claude |
| `src/telegram-v2.js` | Notificacoes Telegram |

## Configuracoes Criticas

### Chrome Debug Mode
Chrome DEVE rodar com:
```bash
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome \
  --remote-debugging-port=9222 \
  --disable-background-timer-throttling \
  --disable-backgrounding-occluded-windows \
  --disable-renderer-backgrounding
```

### LaunchAgent (Daemon)
Arquivo: `~/Library/LaunchAgents/com.botxposts.daemon.plist`
- Chama `/usr/local/bin/node scripts/cron-daemon.js` diretamente
- WorkingDirectory: `/Users/user/AppsCalude/Bot-X-Posts`
- KeepAlive com SuccessfulExit: false (reinicia apenas em crash)
- ThrottleInterval: 30 segundos

### Caminhos Absolutos
**IMPORTANTE:** Quando spawn processos via launchd, SEMPRE usar caminho absoluto:
- Node: `/usr/local/bin/node` (NAO apenas `node`)

### Anti-Timeout (Mac Sleep)
- App Nap desativado para Chrome: `defaults write com.google.Chrome NSAppSleepDisabled -bool YES`
- ProcessType: Interactive no plist
- Timeouts configurados: 60s page, 120s protocol

## Curadoria v2

### Fontes de Dados
- **CoinGecko:** Preco BTC/ETH, Fear & Greed Index, trending coins
- **Twitter API:** Busca trending por hashtag (com cache 15min para rate limits)
- **Hacker News:** Top stories para vibeCoding
- **Claude:** Analise de sentimento e narrativas

### Rate Limits
Twitter tem rate limit agressivo. Sistema usa cache e fallback graceful.

## Comandos Uteis

```bash
# Status do daemon
launchctl list | grep bot

# Ver logs
tail -f logs/daemon.log
tail -f logs/daemon-error.log

# Reiniciar daemon
pkill -9 -f "cron-daemon"
launchctl unload ~/Library/LaunchAgents/com.botxposts.daemon.plist
launchctl load ~/Library/LaunchAgents/com.botxposts.daemon.plist

# Testar post manual
node scripts/auto-post.js vibeCoding

# Verificar Chrome conectado
curl -s http://localhost:9222/json/version
```

## Problemas Conhecidos e Solucoes

| Problema | Causa | Solucao |
|----------|-------|---------|
| `spawn node ENOENT` | PATH nao disponivel no launchd | Usar `/usr/local/bin/node` |
| Daemons duplicados | plist reiniciando rapido | ThrottleInterval + KeepAlive config |
| Telegram 409 Conflict | Multiplas instancias polling | Garantir apenas 1 daemon |
| Aba X nao encontrada | Chrome sem X.com aberto | Codigo abre automaticamente |
| Timeout com tela bloqueada | App Nap / throttling | Flags anti-suspensao no Chrome |
| Twitter rate limit | Muitas requisicoes | Cache de 15 min, fallback |

## Fluxo de Postagem

1. Cron dispara no horario
2. `curateContentV2()` busca dados frescos
3. `generatePost()` gera texto com Claude
4. Preview enviado no Telegram (2 min para cancelar)
5. `postTweet()` digita no X como humano (delays variaveis)
6. Confirmacao no Telegram

## Notas de Desenvolvimento

- Posts max 500 chars
- Digitacao humanizada: 70-130ms entre chars, pausas apos pontuacao
- 60 segundos entre posts multiplos
- Retry automatico: 3 tentativas na conexao Chrome, 2 no post